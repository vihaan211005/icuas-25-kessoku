name: icuas_competition_example
root: ./
startup_window: crazyflies_start
pre_window: |
  source <%= @settings["setup_name"] %>
windows:
  - crazyflies_start:
      layout: tiled
      panes:
        - bash /root/CrazySim/ros2_ws/src/icuas25_competition/launch/sitl_multiagent_text.sh -m crazyflie -f $SPAWN_POSE_DOC -w $ENV_NAME -n $NUM_ROBOTS
        - waitForCfGazebo; sleep 8; bash ./generate_gazebo_bridge_yaml.sh $NUM_ROBOTS; ros2 launch icuas25_competition cf_velmux_launch.py
        - waitForCfGazebo; sleep 10; ros2 launch icuas25_competition aruco_recognition.launch.py
        - waitForCfGazebo; sleep 10; ros2 launch icuas25_competition octomap_server.launch.py

  - topic_pane:
      layout: tiled
      panes:
        - history -s "ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args --remap cmd_vel:=/cf_1/cmd_vel"

  - submission:
      layout: tiled
      panes:
        - waitForCfGazebo; sleep 25; ros2 run icuas25_competition crazyflie_client
        - waitForCfGazebo; sleep 25; while true; do ros2 topic echo /target_found 2>/dev/null | grep .; sleep 1; done
        - waitForCfGazebo; sleep 25; python3 /root/CrazySim/ros2_ws/src/icuas25_competition/scripts/odom_logger.py
        - waitForCfGazebo; sleep 25; python3 /root/CrazySim/ros2_ws/src/icuas25_competition/scripts/battery_logger.py
  - octomap_viz:
      layout: tiled
      panes:
        - waitForCfGazebo; sleep 25; ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 world map
        - waitForCfGazebo; sleep 25; echo "ros2 run octomap_server octomap_server_node --ros-args --params-file ../config/octomap.yaml"